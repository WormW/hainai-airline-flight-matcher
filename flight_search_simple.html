<!DOCTYPE html>
<!--
    Êµ∑ÂçóËà™Á©∫Ëà™Áè≠ÈÖçÂØπÂô® (HaiNan Airline Flight Matcher)
    ü§ñ AI Generated by Augment + Claude Sonnet 4

    ‰∏Ä‰∏™Êô∫ËÉΩÁöÑËà™Áè≠ÊêúÁ¥¢Á≥ªÁªüÔºå‰∏ìÈó®Áî®‰∫éÊü•ÊâæÁ¨¶ÂêàÁâπÂÆöÊó∂Èó¥Êù°‰ª∂ÁöÑÂæÄËøîËà™Áè≠ÁªÑÂêà

    ÂäüËÉΩÁâπËâ≤Ôºö
    - ÂèåÊú∫Âú∫ÈÖçÂØπÊêúÁ¥¢
    - Êô∫ËÉΩÊãºÈü≥ÊêúÁ¥¢
    - ÂüéÂ∏ÇÊ®°ÂºèÂåπÈÖç
    - Âçï‰∏ÄÂæÄËøîÊ®°Âºè
    - ÊêúÁ¥¢ÂéÜÂè≤ËÆ∞ÂΩï
    - ÂìçÂ∫îÂºèËÆæËÆ°

    ‰ΩúËÄÖ: WormW (with Augment + Claude Sonnet 4)
-->
<html>
<head>
    <meta charset="utf-8">
    <title>Êµ∑ÂçóËà™Á©∫Ëà™Áè≠ÈÖçÂØπÂô® - AI Generated</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            text-align: center;
        }
        
        .search-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: end;
            justify-content: center;
        }
        
        .search-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        
        .search-group label {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }
        
        select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .reset-btn {
            background: #95a5a6;
        }
        
        .reset-btn:hover {
            background: #7f8c8d;
        }
        
        .content-area {
            display: flex;
            gap: 30px;
        }
        
        .destinations-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .flights-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .destination-item {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .destination-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .destination-item.selected {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .destination-name {
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .destination-summary {
            font-size: 13px;
            color: #7f8c8d;
        }
        
        .flight-group {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .group-header {
            background: #ecf0f1;
            padding: 15px;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
        }
        
        .flight-detail {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .flight-detail:last-child {
            border-bottom: none;
        }
        
        .outbound-flight {
            background: #fff5f5;
            border-left: 4px solid #e74c3c;
        }
        
        .return-flight {
            background: #f0fff4;
            border-left: 4px solid #27ae60;
        }
        
        .flight-info {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .flight-route {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .flight-time {
            color: #7f8c8d;
            font-size: 13px;
        }
        
        .no-results {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px 20px;
            font-size: 16px;
        }
        
        .criteria-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #6c757d;
            border-left: 4px solid #17a2b8;
        }
        
        .criteria-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .hidden {
            display: none;
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩïÊ†∑Âºè */
        .history-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .history-item {
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .history-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .history-item-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .history-item-details {
            font-size: 12px;
            color: #7f8c8d;
        }

        .history-clear {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            float: right;
        }

        .history-clear:hover {
            background: #c0392b;
        }

        /* ÊêúÁ¥¢‰∏ãÊãâÊ°ÜÊ†∑Âºè */
        .search-dropdown {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .suggestion-item:hover {
            background: #f0f8ff;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-highlight {
            background: #ffeb3b;
            font-weight: bold;
        }

        .suggestion-city-header {
            background: #f0f8ff;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
            cursor: default;
        }

        .suggestion-city-header:hover {
            background: #f0f8ff;
        }

        .suggestion-sub-item {
            padding-left: 25px;
            font-size: 13px;
            color: #555;
        }

        @media (max-width: 768px) {
            .content-area {
                flex-direction: column;
            }

            .search-panel {
                flex-direction: column;
                align-items: stretch;
            }

            .search-group {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ëà™Áè≠ÊêúÁ¥¢Á≥ªÁªü</h1>
            <div class="search-panel">
                <div class="search-group">
                    <label for="airport-a-input">AÊú∫Âú∫ÔºàÂá∫ÂèëÂú∞Ôºâ</label>
                    <div class="search-dropdown">
                        <input type="text" id="airport-a-input" class="search-input" placeholder="ËæìÂÖ•Êú∫Âú∫ÂêçÁß∞ÊàñÊãºÈü≥ÊêúÁ¥¢..."
                               oninput="handleAirportSearch('a')" onfocus="showSuggestions('a')" onblur="hideSuggestions('a')">
                        <div id="airport-a-suggestions" class="search-suggestions"></div>
                        <input type="hidden" id="airport-a" value="">
                    </div>
                </div>

                <div class="search-group">
                    <label for="airport-b-input">BÊú∫Âú∫ÔºàÂá∫ÂèëÂú∞Ôºâ</label>
                    <div class="search-dropdown">
                        <input type="text" id="airport-b-input" class="search-input" placeholder="ËæìÂÖ•Êú∫Âú∫ÂêçÁß∞ÊàñÊãºÈü≥ÊêúÁ¥¢..."
                               oninput="handleAirportSearch('b')" onfocus="showSuggestions('b')" onblur="hideSuggestions('b')">
                        <div id="airport-b-suggestions" class="search-suggestions"></div>
                        <input type="hidden" id="airport-b" value="">
                    </div>
                </div>

                <div class="search-group">
                    <label>
                        <input type="checkbox" id="city-mode" onchange="updateSearchMode()">
                        ÊåâÂüéÂ∏ÇÂåπÈÖçÔºàÂ¶ÇÂåó‰∫¨ÂåÖÂê´È¶ñÈÉΩÊú∫Âú∫ÂíåÂ§ßÂÖ¥Êú∫Âú∫Ôºâ
                    </label>
                </div>

                <div class="search-group">
                    <label>
                        <input type="checkbox" id="single-mode" onchange="updateSearchMode()">
                        Âçï‰∏ÄÂæÄËøîÊ®°ÂºèÔºàÂè™ÈúÄË¶ÅAÊàñBÂÖ∂‰∏≠‰∏Ä‰∏™ÊúâÂæÄËøîÂç≥ÂèØÔºâ
                    </label>
                </div>

                <div class="search-group">
                    <button onclick="findDestinations()">Êü•ÊâæÁ¨¶ÂêàÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞</button>
                    <button class="reset-btn" onclick="resetSearch()">ÈáçÁΩÆÊêúÁ¥¢</button>
                </div>
            </div>
        </div>

        <div class="history-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div class="panel-title" style="margin: 0;">ÊêúÁ¥¢ÂéÜÂè≤</div>
                <button class="history-clear" onclick="clearHistory()">Ê∏ÖÁ©∫ÂéÜÂè≤</button>
            </div>
            <div id="history-content">
                <div class="loading">ÊöÇÊó†ÊêúÁ¥¢ÂéÜÂè≤</div>
            </div>
        </div>
        
        <div class="content-area">
            <div class="destinations-panel">
                <div class="panel-title">Á¨¶ÂêàÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫</div>
                <div id="destinations-content">
                    <div class="loading">ËØ∑ÈÄâÊã©AÊú∫Âú∫ÂíåBÊú∫Âú∫ÔºåÁÑ∂ÂêéÁÇπÂáªÊü•Êâæ</div>
                </div>
            </div>
            
            <div class="flights-panel">
                <div class="panel-title">Ëà™Áè≠ËØ¶ÊÉÖ</div>
                <div id="flights-content">
                    <div class="loading">ËØ∑ÂÖàÈÄâÊã©ÁõÆÁöÑÂú∞Êú∫Âú∫</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let flights = [];
        let currentDestinations = [];
        let selectedDestination = null;
        let allAirports = [];
        let searchHistory = [];

        // ÁÆÄÂåñÁöÑÊãºÈü≥Êò†Â∞ÑË°®
        const pinyinMap = {
            'Âåó‰∫¨': 'beijing', '‰∏äÊµ∑': 'shanghai', 'ÂπøÂ∑û': 'guangzhou', 'Ê∑±Âú≥': 'shenzhen',
            'ÊàêÈÉΩ': 'chengdu', 'ÈáçÂ∫Ü': 'chongqing', 'Êù≠Â∑û': 'hangzhou', 'Ë•øÂÆâ': 'xian',
            'Âçó‰∫¨': 'nanjing', 'Ê≠¶Ê±â': 'wuhan', 'Â§©Ê¥•': 'tianjin', 'ÈùíÂ≤õ': 'qingdao',
            'Â§ßËøû': 'dalian', 'Âé¶Èó®': 'xiamen', 'ÊòÜÊòé': 'kunming', 'ÈïøÊ≤ô': 'changsha',
            'ÈÉëÂ∑û': 'zhengzhou', 'Ê≤àÈò≥': 'shenyang', 'ÂìàÂ∞îÊª®': 'haerbin', 'ÊµéÂçó': 'jinan',
            'Á¶èÂ∑û': 'fuzhou', 'Áü≥ÂÆ∂Â∫Ñ': 'shijiazhuang', 'ÈïøÊò•': 'changchun', 'ÂêàËÇ•': 'hefei',
            'ÂçóÊòå': 'nanchang', 'Ë¥µÈò≥': 'guiyang', 'Â§™Âéü': 'taiyuan', 'ÂÖ∞Â∑û': 'lanzhou',
            'Êµ∑Âè£': 'haikou', '‰∏â‰∫ö': 'sanya', '‰πåÈ≤ÅÊú®ÈΩê': 'wulumuqi', 'ÊãâËê®': 'lasa',
            'Èì∂Â∑ù': 'yinchuan', 'Ë•øÂÆÅ': 'xining', 'ÂëºÂíåÊµ©Áâπ': 'huhehaote', 'ÂçóÂÆÅ': 'nanning',
            'Ê°ÇÊûó': 'guilin', 'Ê∏©Â∑û': 'wenzhou', 'ÂÆÅÊ≥¢': 'ningbo', 'Êó†Èî°': 'wuxi',
            'ËãèÂ∑û': 'suzhou', 'Â∏∏Â∑û': 'changzhou', 'ÂæêÂ∑û': 'xuzhou', 'Êâ¨Â∑û': 'yangzhou',
            'Ê≥∞Â∑û': 'taizhou', 'ÈïáÊ±ü': 'zhenjiang', 'ÂçóÈÄö': 'nantong', 'ÁõêÂüé': 'yancheng',
            'Ê∑ÆÂÆâ': 'huaian', 'Ëøû‰∫ëÊ∏Ø': 'lianyungang', 'ÂÆøËøÅ': 'suqian', 'È¶ñÈÉΩ': 'shoudu',
            'Êµ¶‰∏ú': 'pudong', 'ËôπÊ°•': 'hongqiao', 'ÁôΩ‰∫ë': 'baiyun', 'ÂÆùÂÆâ': 'baoan',
            'Â§©Â∫ú': 'tianfu', 'ÂèåÊµÅ': 'shuangliu', 'Ê±üÂåó': 'jiangbei', 'ËêßÂ±±': 'xiaoshan',
            'Âí∏Èò≥': 'xianyang', 'Á¶ÑÂè£': 'lukou', 'ËÉ∂‰∏ú': 'jiaodong', 'È´òÂ¥é': 'gaoqi',
            'Âë®Ê∞¥Â≠ê': 'zhoushuizi', 'Ê°É‰ªô': 'taoxian', 'Â§™Âπ≥': 'taiping', 'ÈªÑËä±': 'huanghua',
            'Â§©Ê≤≥': 'tianhe', 'Êñ∞ÈÉë': 'xinzheng', 'ÈÅ•Â¢ô': 'yaogiang', 'Èïø‰πê': 'changle',
            'ÊòåÂåó': 'changbei', 'ÈæôÊ¥ûÂ†°': 'longdongbao', '‰∏≠Â∑ù': 'zhongchuan', 'Â§©Â±±': 'tianshan',
            'Ë¥°Âòé': 'gongga', 'Ê≤≥‰∏ú': 'hedong', 'ÊõπÂÆ∂Â†°': 'caojiabao', 'ÁôΩÂ°î': 'baita',
            'ÁæéÂÖ∞': 'meilan', 'Âá§Âá∞': 'fenghuang', 'Â§ßÂÖ¥': 'daxing', 'Êú∫Âú∫': 'jichang',
            'ÂõΩÈôÖ': 'guoji', 'ÂõΩÂÜÖ': 'guonei', 'Ëà™Á©∫': 'hangkong', 'Ê∏Ø': 'gang'
        };

        // Ëé∑ÂèñÊãºÈü≥
        function getPinyin(text) {
            let pinyin = '';
            for (let char of text) {
                if (pinyinMap[char]) {
                    pinyin += pinyinMap[char];
                } else {
                    pinyin += char.toLowerCase();
                }
            }
            return pinyin;
        }

        // ÂüéÂ∏ÇÊò†Â∞ÑË°®
        const cityMapping = {
            'Âåó‰∫¨': ['Âåó‰∫¨È¶ñÈÉΩÂõΩÈôÖÊú∫Âú∫', 'Âåó‰∫¨Â§ßÂÖ¥ÂõΩÈôÖÊú∫Âú∫'],
            '‰∏äÊµ∑': ['‰∏äÊµ∑ËôπÊ°•ÂõΩÈôÖÊú∫Âú∫', '‰∏äÊµ∑Êµ¶‰∏úÂõΩÈôÖÊú∫Âú∫'],
            'ÂπøÂ∑û': ['ÂπøÂ∑ûÁôΩ‰∫ëÂõΩÈôÖÊú∫Âú∫'],
            'Ê∑±Âú≥': ['Ê∑±Âú≥ÂÆùÂÆâÂõΩÈôÖÊú∫Âú∫'],
            'ÊàêÈÉΩ': ['ÊàêÈÉΩÂ§©Â∫úÂõΩÈôÖÊú∫Âú∫', 'ÊàêÈÉΩÂèåÊµÅÂõΩÈôÖÊú∫Âú∫'],
            'ÈáçÂ∫Ü': ['ÈáçÂ∫ÜÊ±üÂåóÂõΩÈôÖÊú∫Âú∫'],
            'Êù≠Â∑û': ['Êù≠Â∑ûËêßÂ±±ÂõΩÈôÖÊú∫Âú∫'],
            '‰∏â‰∫ö': ['‰∏â‰∫öÂá§Âá∞ÂõΩÈôÖÊú∫Âú∫'],
            'Êµ∑Âè£': ['Êµ∑Âè£ÁæéÂÖ∞ÂõΩÈôÖÊú∫Âú∫'],
            'ÊòÜÊòé': ['ÊòÜÊòéÈïøÊ∞¥ÂõΩÈôÖÊú∫Âú∫'],
            'Ë•øÂÆâ': ['Ë•øÂÆâÂí∏Èò≥ÂõΩÈôÖÊú∫Âú∫'],
            'Âçó‰∫¨': ['Âçó‰∫¨Á¶ÑÂè£ÂõΩÈôÖÊú∫Âú∫'],
            'ÈùíÂ≤õ': ['ÈùíÂ≤õËÉ∂‰∏úÂõΩÈôÖÊú∫Âú∫'],
            'Âé¶Èó®': ['Âé¶Èó®È´òÂ¥éÂõΩÈôÖÊú∫Âú∫'],
            'Â§ßËøû': ['Â§ßËøûÂë®Ê∞¥Â≠êÂõΩÈôÖÊú∫Âú∫'],
            'Ê≤àÈò≥': ['Ê≤àÈò≥Ê°É‰ªôÂõΩÈôÖÊú∫Âú∫'],
            'ÂìàÂ∞îÊª®': ['ÂìàÂ∞îÊª®Â§™Âπ≥ÂõΩÈôÖÊú∫Âú∫'],
            'ÈïøÊ≤ô': ['ÈïøÊ≤ôÈªÑËä±ÂõΩÈôÖÊú∫Âú∫'],
            'Ê≠¶Ê±â': ['Ê≠¶Ê±âÂ§©Ê≤≥ÂõΩÈôÖÊú∫Âú∫'],
            'ÈÉëÂ∑û': ['ÈÉëÂ∑ûÊñ∞ÈÉëÂõΩÈôÖÊú∫Âú∫'],
            'ÊµéÂçó': ['ÊµéÂçóÈÅ•Â¢ôÂõΩÈôÖÊú∫Âú∫'],
            'Á¶èÂ∑û': ['Á¶èÂ∑ûÈïø‰πêÂõΩÈôÖÊú∫Âú∫'],
            'ÂçóÊòå': ['ÂçóÊòåÊòåÂåóÂõΩÈôÖÊú∫Âú∫'],
            'Ë¥µÈò≥': ['Ë¥µÈò≥ÈæôÊ¥ûÂ†°ÂõΩÈôÖÊú∫Âú∫'],
            'ÂÖ∞Â∑û': ['ÂÖ∞Â∑û‰∏≠Â∑ùÂõΩÈôÖÊú∫Âú∫'],
            '‰πåÈ≤ÅÊú®ÈΩê': ['‰πåÈ≤ÅÊú®ÈΩêÂ§©Â±±ÂõΩÈôÖÊú∫Âú∫'],
            'ÊãâËê®': ['ÊãâËê®Ë¥°ÂòéÂõΩÈôÖÊú∫Âú∫'],
            'Èì∂Â∑ù': ['Èì∂Â∑ùÊ≤≥‰∏úÂõΩÈôÖÊú∫Âú∫'],
            'Ë•øÂÆÅ': ['Ë•øÂÆÅÊõπÂÆ∂Â†°Êú∫Âú∫'],
            'ÂëºÂíåÊµ©Áâπ': ['ÂëºÂíåÊµ©ÁâπÁôΩÂ°îÂõΩÈôÖÊú∫Âú∫']
        };

        // Ê†πÊçÆÊú∫Âú∫ÂêçËé∑ÂèñÂüéÂ∏ÇÂêç
        function getCityFromAirport(airport) {
            const isCityMode = document.getElementById('city-mode').checked;

            if (isCityMode) {
                // ÂüéÂ∏ÇÊ®°ÂºèÔºö‰ΩøÁî®Ââç‰∏§‰∏™Â≠ó‰Ωú‰∏∫ÂüéÂ∏ÇÂêç
                return airport.substring(0, 2);
            } else {
                // Á≤æÁ°ÆÊ®°ÂºèÔºöËøîÂõûÂÆåÊï¥Êú∫Âú∫Âêç
                return airport;
            }
        }

        // Ê†πÊçÆÂüéÂ∏ÇÂêçËé∑ÂèñÊâÄÊúâÊú∫Âú∫
        function getAirportsFromCity(city) {
            const isCityMode = document.getElementById('city-mode').checked;

            if (isCityMode) {
                // ÂüéÂ∏ÇÊ®°ÂºèÔºöÊü•ÊâæÊâÄÊúâ‰ª•ËØ•ÂüéÂ∏ÇÂêçÂºÄÂ§¥ÁöÑÊú∫Âú∫
                return allAirports.filter(airport => airport.startsWith(city));
            } else {
                // Á≤æÁ°ÆÊ®°ÂºèÔºöËøîÂõûÂçï‰∏™Êú∫Âú∫
                return [city];
            }
        }

        // Ê£ÄÊü•‰∏§‰∏™Êú∫Âú∫ÊòØÂê¶Â±û‰∫éÂêå‰∏ÄÂüéÂ∏Ç
        function isSameCity(airport1, airport2) {
            const city1 = getCityFromAirport(airport1);
            const city2 = getCityFromAirport(airport2);
            return city1 === city2;
        }
        
        // Âä†ËΩΩËà™Áè≠Êï∞ÊçÆ
        async function loadFlights() {
            try {
                const response = await fetch('flights.json');
                flights = await response.json();
                console.log(`Âä†ËΩΩ‰∫Ü ${flights.length} Êù°Ëà™Áè≠Êï∞ÊçÆ`);
                initializeAirportSelects();
            } catch (error) {
                console.error('Âä†ËΩΩËà™Áè≠Êï∞ÊçÆÂ§±Ë¥•:', error);
                alert('Âä†ËΩΩËà™Áè≠Êï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Á°Æ‰øù flights.json Êñá‰ª∂Â≠òÂú®');
            }
        }
        
        // ÂàùÂßãÂåñÊú∫Âú∫Êï∞ÊçÆ
        function initializeAirportSelects() {
            const airports = new Set();

            flights.forEach(flight => {
                airports.add(flight.departure);
                airports.add(flight.arrival);
            });

            allAirports = Array.from(airports).sort();

            // Âä†ËΩΩÊêúÁ¥¢ÂéÜÂè≤
            loadSearchHistory();
        }

        // Â§ÑÁêÜÊú∫Âú∫ÊêúÁ¥¢
        function handleAirportSearch(type) {
            const input = document.getElementById(`airport-${type}-input`);
            const suggestions = document.getElementById(`airport-${type}-suggestions`);
            const query = input.value.toLowerCase();

            if (query.length === 0) {
                // Ê≤°ÊúâËæìÂÖ•ÂÜÖÂÆπÊó∂ÔºåÊòæÁ§∫ÊâÄÊúâÊú∫Âú∫ÔºàÊåâÂüéÂ∏ÇÂàÜÁªÑÔºâ
                showAllAirportsSuggestions(type);
                return;
            }

            // ÊúâËæìÂÖ•ÂÜÖÂÆπÊó∂ÔºåËøõË°åËøáÊª§ÊêúÁ¥¢
            const matches = allAirports.filter(airport => {
                const airportLower = airport.toLowerCase();
                const airportPinyin = getPinyin(airport);
                return airportLower.includes(query) || airportPinyin.includes(query);
            });

            if (matches.length > 0) {
                let html = '';
                matches.slice(0, 10).forEach(airport => {
                    const highlighted = highlightMatch(airport, query);
                    html += `<div class="suggestion-item" onmousedown="selectAirport('${type}', '${airport}')">${highlighted}</div>`;
                });
                suggestions.innerHTML = html;
                suggestions.style.display = 'block';
            } else {
                suggestions.style.display = 'none';
            }
        }

        // ÊòæÁ§∫ÊâÄÊúâÊú∫Âú∫Âª∫ËÆÆÔºàÊåâÂüéÂ∏ÇÂàÜÁªÑÔºâ
        function showAllAirportsSuggestions(type) {
            const suggestions = document.getElementById(`airport-${type}-suggestions`);

            // ÊåâÂüéÂ∏ÇÂàÜÁªÑ
            const cityGroups = {};
            allAirports.forEach(airport => {
                const cityName = airport.substring(0, 2); // Ââç‰∏§‰∏™Â≠ó‰Ωú‰∏∫ÂüéÂ∏ÇÂêç
                if (!cityGroups[cityName]) {
                    cityGroups[cityName] = [];
                }
                cityGroups[cityName].push(airport);
            });

            // Ë∞ÉËØï‰ø°ÊÅØÔºöÊ£ÄÊü•Âåó‰∫¨ÁöÑÂàÜÁªÑ
            if (cityGroups['Âåó‰∫¨']) {
                console.log('Âåó‰∫¨Êú∫Âú∫ÂàÜÁªÑ:', cityGroups['Âåó‰∫¨']);
            }
            console.log('ÊÄªÂÖ±Êú∫Âú∫Êï∞Èáè:', allAirports.length);
            console.log('ÂüéÂ∏ÇÂàÜÁªÑÊï∞Èáè:', Object.keys(cityGroups).length);

            let html = '';
            // ÊåâÂüéÂ∏ÇÂêçÊéíÂ∫è
            const sortedCities = Object.keys(cityGroups).sort();

            // ÂÖàÊòæÁ§∫Â§öÊú∫Âú∫ÂüéÂ∏ÇÔºåÂÜçÊòæÁ§∫ÂçïÊú∫Âú∫ÂüéÂ∏Ç
            const multiAirportCities = [];
            const singleAirportCities = [];

            sortedCities.forEach(cityName => {
                const airports = cityGroups[cityName];
                if (airports.length > 1) {
                    multiAirportCities.push(cityName);
                } else {
                    singleAirportCities.push(cityName);
                }
            });

            // ÊòæÁ§∫Â§öÊú∫Âú∫ÂüéÂ∏ÇÔºà‰ºòÂÖàÊòæÁ§∫ÔºåÈôêÂà∂Ââç10‰∏™Ôºâ
            multiAirportCities.slice(0, 10).forEach(cityName => {
                const airports = cityGroups[cityName];
                html += `<div class="suggestion-item suggestion-city-header">${cityName} (${airports.length}‰∏™Êú∫Âú∫)</div>`;
                airports.forEach(airport => {
                    html += `<div class="suggestion-item suggestion-sub-item" onmousedown="selectAirport('${type}', '${airport}')">&nbsp;&nbsp;${airport}</div>`;
                });
            });

            // ÊòæÁ§∫ÂçïÊú∫Âú∫ÂüéÂ∏ÇÔºàÈôêÂà∂Ââç20‰∏™Ôºâ
            singleAirportCities.slice(0, 100).forEach(cityName => {
                const airports = cityGroups[cityName];
                html += `<div class="suggestion-item" onmousedown="selectAirport('${type}', '${airports[0]}')">${airports[0]}</div>`;
            });

            suggestions.innerHTML = html;
            suggestions.style.display = 'block';
        }

        // È´ò‰∫ÆÂåπÈÖçÊñáÊú¨
        function highlightMatch(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="suggestion-highlight">$1</span>');
        }

        // ÈÄâÊã©Êú∫Âú∫
        function selectAirport(type, airport) {
            document.getElementById(`airport-${type}-input`).value = airport;
            document.getElementById(`airport-${type}`).value = airport;
            document.getElementById(`airport-${type}-suggestions`).style.display = 'none';
        }

        // ÊòæÁ§∫Âª∫ËÆÆ
        function showSuggestions(type) {
            const input = document.getElementById(`airport-${type}-input`);
            if (input.value.length > 0) {
                handleAirportSearch(type);
            } else {
                // ÁÇπÂáªÁ©∫ËæìÂÖ•Ê°ÜÊó∂ÔºåÂ±ïÂºÄÊòæÁ§∫ÊâÄÊúâÊú∫Âú∫
                showAllAirportsSuggestions(type);
            }
        }

        // ÈöêËóèÂª∫ËÆÆ
        function hideSuggestions(type) {
            setTimeout(() => {
                document.getElementById(`airport-${type}-suggestions`).style.display = 'none';
            }, 200);
        }
        
        // ‰øùÂ≠òÊêúÁ¥¢ÂéÜÂè≤
        function saveSearchHistory(airportA, airportB, isCityMode, isSingleMode, resultCount) {
            const historyItem = {
                id: Date.now(),
                airportA: airportA,
                airportB: airportB,
                isCityMode: isCityMode,
                isSingleMode: isSingleMode,
                resultCount: resultCount,
                timestamp: new Date().toLocaleString()
            };

            // ÈÅøÂÖçÈáçÂ§çËÆ∞ÂΩï
            const existing = searchHistory.find(item =>
                item.airportA === airportA &&
                item.airportB === airportB &&
                item.isCityMode === isCityMode &&
                item.isSingleMode === isSingleMode
            );

            if (!existing) {
                searchHistory.unshift(historyItem);
                // ÊúÄÂ§ö‰øùÂ≠ò10Êù°ÂéÜÂè≤ËÆ∞ÂΩï
                if (searchHistory.length > 10) {
                    searchHistory = searchHistory.slice(0, 10);
                }
                localStorage.setItem('flightSearchHistory', JSON.stringify(searchHistory));
                displaySearchHistory();
            }
        }

        // Âä†ËΩΩÊêúÁ¥¢ÂéÜÂè≤
        function loadSearchHistory() {
            const saved = localStorage.getItem('flightSearchHistory');
            if (saved) {
                searchHistory = JSON.parse(saved);
                displaySearchHistory();
            }
        }

        // ÊòæÁ§∫ÊêúÁ¥¢ÂéÜÂè≤
        function displaySearchHistory() {
            const content = document.getElementById('history-content');

            if (searchHistory.length === 0) {
                content.innerHTML = '<div class="loading">ÊöÇÊó†ÊêúÁ¥¢ÂéÜÂè≤</div>';
                return;
            }

            let html = '';
            searchHistory.forEach(item => {
                const modeText = [];
                if (item.isCityMode) modeText.push('ÂüéÂ∏ÇÊ®°Âºè');
                if (item.isSingleMode) modeText.push('Âçï‰∏ÄÂæÄËøî');
                const modeStr = modeText.length > 0 ? ` (${modeText.join(', ')})` : '';

                html += `
                    <div class="history-item" onclick="loadHistoryItem(${item.id})">
                        <div class="history-item-header">
                            ${item.airportA || 'Êú™ÈÄâÊã©'} ‚Üî ${item.airportB || 'Êú™ÈÄâÊã©'}${modeStr}
                        </div>
                        <div class="history-item-details">
                            ${item.timestamp} | ÊâæÂà∞ ${item.resultCount} ‰∏™ÁõÆÁöÑÂú∞
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩïÈ°π
        function loadHistoryItem(id) {
            const item = searchHistory.find(h => h.id === id);
            if (!item) return;

            // ËÆæÁΩÆÊêúÁ¥¢Êù°‰ª∂
            document.getElementById('airport-a-input').value = item.airportA || '';
            document.getElementById('airport-a').value = item.airportA || '';
            document.getElementById('airport-b-input').value = item.airportB || '';
            document.getElementById('airport-b').value = item.airportB || '';
            document.getElementById('city-mode').checked = item.isCityMode;
            document.getElementById('single-mode').checked = item.isSingleMode;

            // Ëá™Âä®ÊâßË°åÊêúÁ¥¢
            findDestinations();
        }

        // Ê∏ÖÁ©∫ÊêúÁ¥¢ÂéÜÂè≤
        function clearHistory() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊêúÁ¥¢ÂéÜÂè≤ÂêóÔºü')) {
                searchHistory = [];
                localStorage.removeItem('flightSearchHistory');
                displaySearchHistory();
            }
        }

        // Êü•ÊâæÁ¨¶ÂêàÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞
        function findDestinations() {
            const airportA = document.getElementById('airport-a').value;
            const airportB = document.getElementById('airport-b').value;
            const isSingleMode = document.getElementById('single-mode').checked;
            const isCityMode = document.getElementById('city-mode').checked;

            // Âçï‰∏ÄÂæÄËøîÊ®°ÂºèÔºöËá≥Â∞ëÈúÄË¶ÅÈÄâÊã©‰∏Ä‰∏™Êú∫Âú∫
            if (isSingleMode) {
                if (!airportA && !airportB) {
                    alert('ËØ∑Ëá≥Â∞ëÈÄâÊã©AÊú∫Âú∫ÊàñBÊú∫Âú∫');
                    return;
                }
                if (airportA && airportB && airportA === airportB) {
                    alert('AÊú∫Âú∫ÂíåBÊú∫Âú∫‰∏çËÉΩÁõ∏Âêå');
                    return;
                }
            } else {
                // ÂèåÈáçÂæÄËøîÊ®°ÂºèÔºöÂøÖÈ°ªÈÄâÊã©‰∏§‰∏™Êú∫Âú∫
                if (!airportA || !airportB) {
                    alert('ËØ∑ÈÄâÊã©AÊú∫Âú∫ÂíåBÊú∫Âú∫');
                    return;
                }
                if (airportA === airportB) {
                    alert('AÊú∫Âú∫ÂíåBÊú∫Âú∫‰∏çËÉΩÁõ∏Âêå');
                    return;
                }
            }

            const destinations = findValidDestinations(airportA, airportB);
            displayDestinations(destinations, airportA, airportB);

            // ‰øùÂ≠òÊêúÁ¥¢ÂéÜÂè≤
            saveSearchHistory(airportA, airportB, isCityMode, isSingleMode, destinations.size);

            // Ê∏ÖÁ©∫Ëà™Áè≠ËØ¶ÊÉÖ
            document.getElementById('flights-content').innerHTML =
                '<div class="loading">ËØ∑ÈÄâÊã©‰∏Ä‰∏™ÁõÆÁöÑÂú∞Êú∫Âú∫Êü•ÁúãËà™Áè≠ËØ¶ÊÉÖ</div>';
            selectedDestination = null;
        }
        
        // Êü•ÊâæÊúâÊïàÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫
        function findValidDestinations(airportA, airportB) {
            const destinationMap = new Map();
            
            // Ëé∑ÂèñÊâÄÊúâÂèØËÉΩÁöÑÁõÆÁöÑÂú∞
            const allDestinations = new Set();
            flights.forEach(flight => {
                if (flight.departure === airportA || flight.departure === airportB) {
                    allDestinations.add(flight.arrival);
                }
            });
            
            // Ê£ÄÊü•ÊØè‰∏™ÁõÆÁöÑÂú∞ÊòØÂê¶Á¨¶ÂêàÊù°‰ª∂
            allDestinations.forEach(destination => {
                if (destination === airportA || destination === airportB) {
                    return; // Ë∑≥Ëøá‰∏éÂá∫ÂèëÂú∞Áõ∏ÂêåÁöÑÁõÆÁöÑÂú∞
                }
                
                const result = checkDestination(airportA, airportB, destination);
                if (result.valid) {
                    destinationMap.set(destination, result);
                }
            });
            
            return destinationMap;
        }
        
        // Ê£ÄÊü•ÁõÆÁöÑÂú∞ÊòØÂê¶Á¨¶ÂêàÊù°‰ª∂
        function checkDestination(airportA, airportB, destination) {
            const isCityMode = document.getElementById('city-mode').checked;
            const isSingleMode = document.getElementById('single-mode').checked;

            let outboundA = [], outboundB = [], returnA = [], returnB = [];

            // Â§ÑÁêÜAÊú∫Âú∫ÔºàÂ¶ÇÊûúÈÄâÊã©‰∫ÜÔºâ
            if (airportA) {
                if (isCityMode) {
                    const cityA = getCityFromAirport(airportA);
                    const destCity = getCityFromAirport(destination);
                    const airportsA = getAirportsFromCity(cityA);
                    const destAirports = getAirportsFromCity(destCity);

                    outboundA = flights.filter(flight =>
                        airportsA.includes(flight.departure) &&
                        destAirports.includes(flight.arrival) &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnA = flights.filter(flight =>
                        destAirports.includes(flight.departure) &&
                        airportsA.includes(flight.arrival) &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                } else {
                    outboundA = flights.filter(flight =>
                        flight.departure === airportA &&
                        flight.arrival === destination &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnA = flights.filter(flight =>
                        flight.departure === destination &&
                        flight.arrival === airportA &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                }
            }

            // Â§ÑÁêÜBÊú∫Âú∫ÔºàÂ¶ÇÊûúÈÄâÊã©‰∫ÜÔºâ
            if (airportB) {
                if (isCityMode) {
                    const cityB = getCityFromAirport(airportB);
                    const destCity = getCityFromAirport(destination);
                    const airportsB = getAirportsFromCity(cityB);
                    const destAirports = getAirportsFromCity(destCity);

                    outboundB = flights.filter(flight =>
                        airportsB.includes(flight.departure) &&
                        destAirports.includes(flight.arrival) &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnB = flights.filter(flight =>
                        destAirports.includes(flight.departure) &&
                        airportsB.includes(flight.arrival) &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                } else {
                    outboundB = flights.filter(flight =>
                        flight.departure === airportB &&
                        flight.arrival === destination &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnB = flights.filter(flight =>
                        flight.departure === destination &&
                        flight.arrival === airportB &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                }
            }

            const hasCompleteRouteA = airportA && outboundA.length > 0 && returnA.length > 0;
            const hasCompleteRouteB = airportB && outboundB.length > 0 && returnB.length > 0;

            const routes = [];
            if (hasCompleteRouteA) {
                routes.push({
                    type: isCityMode ? `${getCityFromAirport(airportA)}Ë∑ØÁ∫ø` : 'AÊú∫Âú∫Ë∑ØÁ∫ø',
                    outbound: outboundA,
                    return: returnA
                });
            }

            if (hasCompleteRouteB) {
                routes.push({
                    type: isCityMode ? `${getCityFromAirport(airportB)}Ë∑ØÁ∫ø` : 'BÊú∫Âú∫Ë∑ØÁ∫ø',
                    outbound: outboundB,
                    return: returnB
                });
            }

            // Ê†πÊçÆÊ®°ÂºèÂÜ≥ÂÆöÊúâÊïàÊÄß
            let isValid;
            if (isSingleMode) {
                // Âçï‰∏ÄÂæÄËøîÊ®°ÂºèÔºöÂè™Ë¶ÅÊúâ‰∏Ä‰∏™Êú∫Âú∫ÊúâÂÆåÊï¥Ë∑ØÁ∫øÂ∞±ÁÆóÊúâÊïà
                isValid = hasCompleteRouteA || hasCompleteRouteB;
            } else {
                // ÂèåÈáçÂæÄËøîÊ®°ÂºèÔºöÂøÖÈ°ª‰∏§‰∏™Êú∫Âú∫ÈÉΩÊúâÂÆåÊï¥Ë∑ØÁ∫øÊâçÁÆóÊúâÊïà
                isValid = hasCompleteRouteA && hasCompleteRouteB;
            }

            // ÁîüÊàêÊëòË¶Å
            let summary;
            if (isSingleMode) {
                if (routes.length === 0) {
                    summary = 'Êó†ÂèØË°åË∑ØÁ∫ø';
                } else if (routes.length === 1) {
                    summary = `${routes[0].type.replace('Ë∑ØÁ∫ø', '')}ÂèØÂæÄËøî`;
                } else {
                    summary = isCityMode ? '‰∏§ÂüéÂ∏ÇÈÉΩÂèØÂæÄËøî' : 'A„ÄÅBÊú∫Âú∫ÈÉΩÂèØÂæÄËøî';
                }
            } else {
                summary = routes.length === 2 ?
                    (isCityMode ? '‰∏§ÂüéÂ∏ÇÈÉΩÂèØÂæÄËøî' : 'A„ÄÅBÊú∫Âú∫ÈÉΩÂèØÂæÄËøî') :
                    `‰ªÖ${routes.length === 1 ? (hasCompleteRouteA ? (isCityMode ? getCityFromAirport(airportA) : 'A') : (isCityMode ? getCityFromAirport(airportB) : 'B')) : 'Êó†'}${isCityMode ? 'ÂüéÂ∏Ç' : 'Êú∫Âú∫'}ÂèØÂæÄËøî`;
            }

            return {
                valid: isValid,
                routes: routes,
                summary: summary
            };
        }
        
        // ÊòæÁ§∫ÁõÆÁöÑÂú∞ÂàóË°®
        function displayDestinations(destinations, airportA, airportB) {
            const content = document.getElementById('destinations-content');
            const isSingleMode = document.getElementById('single-mode').checked;
            const isCityMode = document.getElementById('city-mode').checked;
            currentDestinations = destinations;

            if (destinations.size === 0) {
                let requirementText;
                if (isSingleMode) {
                    requirementText = 'Ë¶ÅÊ±Ç: Ëá≥Â∞ë‰∏Ä‰∏™Êú∫Âú∫ÊúâÂÆåÊï¥ÂæÄËøîËà™Áè≠';
                    const noResultText = 'Êú™ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫';
                } else {
                    requirementText = 'A„ÄÅBÊú∫Âú∫ÈÉΩÂøÖÈ°ªÊúâÂÆåÊï¥ÂæÄËøîËà™Áè≠';
                    const noResultText = 'Êú™ÊâæÂà∞ÂêåÊó∂Êª°Ë∂≥A„ÄÅBÊú∫Âú∫ÂæÄËøîÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫';
                }

                content.innerHTML = `
                    <div class="criteria-info">
                        <h4>ÊêúÁ¥¢Êù°‰ª∂Ôºö</h4>
                        ${airportA ? `<p>‚Ä¢ AÊú∫Âú∫: ${airportA}</p>` : ''}
                        ${airportB ? `<p>‚Ä¢ BÊú∫Âú∫: ${airportB}</p>` : ''}
                        <p>‚Ä¢ ÂéªÁ®ã: Âë®‰∫î20:00ÂêéÊàñÂë®ÂÖ≠9:00Ââç</p>
                        <p>‚Ä¢ ËøîÁ®ã: Âë®Êó•20:00Âêé</p>
                        <p><strong>‚Ä¢ ${requirementText}</strong></p>
                        ${isCityMode ? '<p>‚Ä¢ ÊåâÂüéÂ∏ÇÂåπÈÖçÊ®°Âºè</p>' : ''}
                        ${isSingleMode ? '<p>‚Ä¢ Âçï‰∏ÄÂæÄËøîÊ®°Âºè</p>' : ''}
                    </div>
                    <div class="no-results">
                        ${isSingleMode ? 'Êú™ÊâæÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫' : 'Êú™ÊâæÂà∞ÂêåÊó∂Êª°Ë∂≥A„ÄÅBÊú∫Âú∫ÂæÄËøîÊù°‰ª∂ÁöÑÁõÆÁöÑÂú∞Êú∫Âú∫'}
                    </div>
                `;
                return;
            }

            let requirementText;
            if (isSingleMode) {
                requirementText = 'Ë¶ÅÊ±Ç: Ëá≥Â∞ë‰∏Ä‰∏™Êú∫Âú∫ÊúâÂÆåÊï¥ÂæÄËøîËà™Áè≠';
            } else {
                requirementText = 'A„ÄÅBÊú∫Âú∫ÈÉΩÂøÖÈ°ªÊúâÂÆåÊï¥ÂæÄËøîËà™Áè≠';
            }

            let html = `
                <div class="criteria-info">
                    <h4>ÊêúÁ¥¢Êù°‰ª∂Ôºö</h4>
                    ${airportA ? `<p>‚Ä¢ AÊú∫Âú∫: ${airportA}</p>` : ''}
                    ${airportB ? `<p>‚Ä¢ BÊú∫Âú∫: ${airportB}</p>` : ''}
                    <p>‚Ä¢ ÂéªÁ®ã: Âë®‰∫î20:00ÂêéÊàñÂë®ÂÖ≠9:00Ââç</p>
                    <p>‚Ä¢ ËøîÁ®ã: Âë®Êó•20:00Âêé</p>
                    <p><strong>‚Ä¢ ${requirementText}</strong></p>
                    ${isCityMode ? '<p>‚Ä¢ ÊåâÂüéÂ∏ÇÂåπÈÖçÊ®°Âºè</p>' : ''}
                    ${isSingleMode ? '<p>‚Ä¢ Âçï‰∏ÄÂæÄËøîÊ®°Âºè</p>' : ''}
                </div>
            `;

            // ÊåâÁõÆÁöÑÂú∞ÂêçÁß∞ÊéíÂ∫è
            const sortedDestinations = Array.from(destinations.entries()).sort((a, b) => a[0].localeCompare(b[0]));

            sortedDestinations.forEach(([destination, info]) => {
                html += `
                    <div class="destination-item" onclick="selectDestination('${destination}')">
                        <div class="destination-name">${destination}</div>
                        <div class="destination-summary">${info.summary}</div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }
        
        // ÈÄâÊã©ÁõÆÁöÑÂú∞
        function selectDestination(destination) {
            selectedDestination = destination;
            
            // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.destination-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.destination-item').classList.add('selected');
            
            // ÊòæÁ§∫Ëà™Áè≠ËØ¶ÊÉÖ
            const destinationInfo = currentDestinations.get(destination);
            displayFlightDetails(destination, destinationInfo);
        }
        
        // ÊòæÁ§∫Ëà™Áè≠ËØ¶ÊÉÖ
        function displayFlightDetails(destination, info) {
            const content = document.getElementById('flights-content');
            
            let html = `<div class="criteria-info">
                <h4>ÁõÆÁöÑÂú∞: ${destination}</h4>
                <p>ÂÖ±ÊâæÂà∞ ${info.routes.length} Êù°ÂèØË°åË∑ØÁ∫ø</p>
            </div>`;
            
            info.routes.forEach(route => {
                html += `<div class="flight-group">`;
                html += `<div class="group-header">${route.type}</div>`;
                
                // ÂéªÁ®ãËà™Áè≠
                html += `<div class="flight-detail outbound-flight">`;
                html += `<div class="flight-route">ÂéªÁ®ãËà™Áè≠</div>`;
                route.outbound.forEach(flight => {
                    const days = flight.days.map(d => ['', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'][d]).join('„ÄÅ');
                    html += `
                        <div class="flight-info">
                            <strong>${flight.airline} ${flight.flight_number}</strong><br>
                            ${flight.departure} ‚Üí ${flight.arrival}<br>
                            <span class="flight-time">Ëµ∑È£û: ${flight.departure_time.display} | Âà∞Ëææ: ${flight.arrival_time.display} | ÊâßÈ£û: Âë®${days}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                
                // ËøîÁ®ãËà™Áè≠
                html += `<div class="flight-detail return-flight">`;
                html += `<div class="flight-route">ËøîÁ®ãËà™Áè≠</div>`;
                route.return.forEach(flight => {
                    const days = flight.days.map(d => ['', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'][d]).join('„ÄÅ');
                    html += `
                        <div class="flight-info">
                            <strong>${flight.airline} ${flight.flight_number}</strong><br>
                            ${flight.departure} ‚Üí ${flight.arrival}<br>
                            <span class="flight-time">Ëµ∑È£û: ${flight.departure_time.display} | Âà∞Ëææ: ${flight.arrival_time.display} | ÊâßÈ£û: Âë®${days}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                
                html += `</div>`;
            });
            
            content.innerHTML = html;
        }
        
        // Êõ¥Êñ∞ÊêúÁ¥¢Ê®°Âºè
        function updateSearchMode() {
            const isCityMode = document.getElementById('city-mode').checked;
            const isSingleMode = document.getElementById('single-mode').checked;

            // Êõ¥Êñ∞ÂüéÂ∏ÇÊò†Â∞ÑË°®Ôºà‰ΩøÁî®Ââç‰∏§‰∏™Â≠ó‰Ωú‰∏∫ÂüéÂ∏ÇÂêçÔºâ
            if (isCityMode) {
                updateCityMappingFromAirports();
            }

            // Ê∏ÖÁ©∫ÂΩìÂâçÊêúÁ¥¢ÁªìÊûú
            document.getElementById('destinations-content').innerHTML =
                '<div class="loading">ËØ∑ÈÄâÊã©Êú∫Âú∫Âπ∂ÁÇπÂáªÊü•Êâæ</div>';
            document.getElementById('flights-content').innerHTML =
                '<div class="loading">ËØ∑ÂÖàÈÄâÊã©ÁõÆÁöÑÂú∞Êú∫Âú∫</div>';
            currentDestinations = [];
            selectedDestination = null;

            // ÊòæÁ§∫ÂΩìÂâçÊ®°ÂºèÁä∂ÊÄÅ
            console.log(`ÊêúÁ¥¢Ê®°ÂºèÊõ¥Êñ∞: ÂüéÂ∏ÇÊ®°Âºè=${isCityMode}, Âçï‰∏ÄÂæÄËøîÊ®°Âºè=${isSingleMode}`);
            if (isCityMode) {
                console.log('ÂüéÂ∏ÇÊò†Â∞ÑË°®Â∑≤Êõ¥Êñ∞Ôºå‰ΩøÁî®Êú∫Âú∫ÂêçÂâç‰∏§‰∏™Â≠ó‰Ωú‰∏∫ÂüéÂ∏ÇÂêç');
            }
        }

        // Ê†πÊçÆÊú∫Âú∫ÂêçÂâç‰∏§‰∏™Â≠óÂä®ÊÄÅÊõ¥Êñ∞ÂüéÂ∏ÇÊò†Â∞ÑË°®
        function updateCityMappingFromAirports() {
            // Ê∏ÖÁ©∫Áé∞ÊúâÊò†Â∞Ñ
            Object.keys(cityMapping).forEach(key => delete cityMapping[key]);

            // Ê†πÊçÆÊâÄÊúâÊú∫Âú∫ÂêçÁîüÊàêÊñ∞ÁöÑÂüéÂ∏ÇÊò†Â∞Ñ
            const cityGroups = {};

            allAirports.forEach(airport => {
                // ÊèêÂèñÂüéÂ∏ÇÂêçÔºàÂâç‰∏§‰∏™Â≠óÔºâ
                const cityName = airport.substring(0, 2);

                if (!cityGroups[cityName]) {
                    cityGroups[cityName] = [];
                }
                cityGroups[cityName].push(airport);
            });

            // Âè™‰øùÁïôÊúâÂ§ö‰∏™Êú∫Âú∫ÁöÑÂüéÂ∏ÇÔºåÊàñËÄÖÊòéÁ°ÆÂåÖÂê´"Êú∫Âú∫"Â≠óÊ†∑ÁöÑ
            Object.keys(cityGroups).forEach(cityName => {
                const airports = cityGroups[cityName];
                // Â¶ÇÊûú‰∏Ä‰∏™ÂüéÂ∏ÇÊúâÂ§ö‰∏™Êú∫Âú∫ÔºåÊàñËÄÖÊú∫Âú∫ÂêçÂåÖÂê´Â∏∏ËßÅÁöÑÊú∫Âú∫Ê†áËØÜËØç
                if (airports.length > 1 || airports.some(airport =>
                    airport.includes('ÂõΩÈôÖ') || airport.includes('Êú∫Âú∫') ||
                    airport.includes('Ëà™Á©∫') || airport.includes('Ê∏Ø'))) {
                    cityMapping[cityName] = airports;
                }
            });

            console.log('Âä®ÊÄÅÁîüÊàêÁöÑÂüéÂ∏ÇÊò†Â∞ÑË°®:', cityMapping);
        }



        // ÈáçÁΩÆÊêúÁ¥¢
        function resetSearch() {
            document.getElementById('airport-a-input').value = '';
            document.getElementById('airport-a').value = '';
            document.getElementById('airport-b-input').value = '';
            document.getElementById('airport-b').value = '';
            document.getElementById('city-mode').checked = false;
            document.getElementById('single-mode').checked = false;

            document.getElementById('destinations-content').innerHTML =
                '<div class="loading">ËØ∑ÈÄâÊã©Êú∫Âú∫Âπ∂ÁÇπÂáªÊü•Êâæ</div>';

            document.getElementById('flights-content').innerHTML =
                '<div class="loading">ËØ∑ÂÖàÈÄâÊã©ÁõÆÁöÑÂú∞Êú∫Âú∫</div>';

            currentDestinations = [];
            selectedDestination = null;
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadFlights();
        });
    </script>
</body>
</html>
