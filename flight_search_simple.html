<!DOCTYPE html>
<!--
    æµ·å—èˆªç©ºèˆªç­é…å¯¹å™¨ (HaiNan Airline Flight Matcher)
    ğŸ¤– AI Generated by Augment + Claude Sonnet 4

    ä¸€ä¸ªæ™ºèƒ½çš„èˆªç­æœç´¢ç³»ç»Ÿï¼Œä¸“é—¨ç”¨äºæŸ¥æ‰¾ç¬¦åˆç‰¹å®šæ—¶é—´æ¡ä»¶çš„å¾€è¿”èˆªç­ç»„åˆ

    åŠŸèƒ½ç‰¹è‰²ï¼š
    - åŒæœºåœºé…å¯¹æœç´¢
    - æ™ºèƒ½æ‹¼éŸ³æœç´¢
    - åŸå¸‚æ¨¡å¼åŒ¹é…
    - å•ä¸€å¾€è¿”æ¨¡å¼
    - æœç´¢å†å²è®°å½•
    - å“åº”å¼è®¾è®¡

    ä½œè€…: WormW (with Augment + Claude Sonnet 4)
-->
<html>
<head>
    <meta charset="utf-8">
    <title>æµ·å—èˆªç©ºèˆªç­é…å¯¹å™¨ - AI Generated</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            text-align: center;
        }
        
        .search-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: end;
            justify-content: center;
        }
        
        .search-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }
        
        .search-group label {
            font-weight: bold;
            font-size: 14px;
            color: #333;
        }
        
        select {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s;
        }
        
        select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .reset-btn {
            background: #95a5a6;
        }
        
        .reset-btn:hover {
            background: #7f8c8d;
        }
        
        .content-area {
            display: flex;
            gap: 30px;
        }
        
        .destinations-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .flights-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .destination-item {
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }
        
        .destination-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }
        
        .destination-item.selected {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .destination-name {
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .destination-summary {
            font-size: 13px;
            color: #7f8c8d;
        }
        
        .flight-group {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .group-header {
            background: #ecf0f1;
            padding: 15px;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
        }
        
        .flight-detail {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .flight-detail:last-child {
            border-bottom: none;
        }
        
        .outbound-flight {
            background: #fff5f5;
            border-left: 4px solid #e74c3c;
        }
        
        .return-flight {
            background: #f0fff4;
            border-left: 4px solid #27ae60;
        }
        
        .flight-info {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .flight-route {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        .flight-time {
            color: #7f8c8d;
            font-size: 13px;
        }
        
        .no-results {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px 20px;
            font-size: 16px;
        }
        
        .criteria-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #6c757d;
            border-left: 4px solid #17a2b8;
        }
        
        .criteria-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .hidden {
            display: none;
        }
        
        /* å†å²è®°å½•æ ·å¼ */
        .history-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .history-item {
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .history-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
        }

        .history-item-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .history-item-details {
            font-size: 12px;
            color: #7f8c8d;
        }

        .history-clear {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            float: right;
        }

        .history-clear:hover {
            background: #c0392b;
        }

        /* æœç´¢ä¸‹æ‹‰æ¡†æ ·å¼ */
        .search-dropdown {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .suggestion-item:hover {
            background: #f0f8ff;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-highlight {
            background: #ffeb3b;
            font-weight: bold;
        }

        .suggestion-city-header {
            background: #f0f8ff;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
            cursor: default;
        }

        .suggestion-city-header:hover {
            background: #f0f8ff;
        }

        .suggestion-sub-item {
            padding-left: 25px;
            font-size: 13px;
            color: #555;
        }

        @media (max-width: 768px) {
            .content-area {
                flex-direction: column;
            }

            .search-panel {
                flex-direction: column;
                align-items: stretch;
            }

            .search-group {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>èˆªç­æœç´¢ç³»ç»Ÿ</h1>
            <div class="search-panel">
                <div class="search-group">
                    <label for="airport-a-input">Aæœºåœºï¼ˆå‡ºå‘åœ°ï¼‰</label>
                    <div class="search-dropdown">
                        <input type="text" id="airport-a-input" class="search-input" placeholder="è¾“å…¥æœºåœºåç§°æˆ–æ‹¼éŸ³æœç´¢..."
                               oninput="handleAirportSearch('a')" onfocus="showSuggestions('a')" onblur="hideSuggestions('a')">
                        <div id="airport-a-suggestions" class="search-suggestions"></div>
                        <input type="hidden" id="airport-a" value="">
                    </div>
                </div>

                <div class="search-group">
                    <label for="airport-b-input">Bæœºåœºï¼ˆå‡ºå‘åœ°ï¼‰</label>
                    <div class="search-dropdown">
                        <input type="text" id="airport-b-input" class="search-input" placeholder="è¾“å…¥æœºåœºåç§°æˆ–æ‹¼éŸ³æœç´¢..."
                               oninput="handleAirportSearch('b')" onfocus="showSuggestions('b')" onblur="hideSuggestions('b')">
                        <div id="airport-b-suggestions" class="search-suggestions"></div>
                        <input type="hidden" id="airport-b" value="">
                    </div>
                </div>

                <div class="search-group">
                    <label>
                        <input type="checkbox" id="city-mode" onchange="updateSearchMode()">
                        æŒ‰åŸå¸‚åŒ¹é…ï¼ˆå¦‚åŒ—äº¬åŒ…å«é¦–éƒ½æœºåœºå’Œå¤§å…´æœºåœºï¼‰
                    </label>
                </div>

                <div class="search-group">
                    <label>
                        <input type="checkbox" id="single-mode" onchange="updateSearchMode()">
                        å•ä¸€å¾€è¿”æ¨¡å¼ï¼ˆåªéœ€è¦Aæˆ–Bå…¶ä¸­ä¸€ä¸ªæœ‰å¾€è¿”å³å¯ï¼‰
                    </label>
                </div>

                <div class="search-group">
                    <button onclick="findDestinations()">æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç›®çš„åœ°</button>
                    <button class="reset-btn" onclick="resetSearch()">é‡ç½®æœç´¢</button>
                </div>
            </div>
        </div>

        <div class="history-panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div class="panel-title" style="margin: 0;">æœç´¢å†å²</div>
                <button class="history-clear" onclick="clearHistory()">æ¸…ç©ºå†å²</button>
            </div>
            <div id="history-content">
                <div class="loading">æš‚æ— æœç´¢å†å²</div>
            </div>
        </div>
        
        <div class="content-area">
            <div class="destinations-panel">
                <div class="panel-title">ç¬¦åˆæ¡ä»¶çš„ç›®çš„åœ°æœºåœº</div>
                <div id="destinations-content">
                    <div class="loading">è¯·é€‰æ‹©Aæœºåœºå’ŒBæœºåœºï¼Œç„¶åç‚¹å‡»æŸ¥æ‰¾</div>
                </div>
            </div>
            
            <div class="flights-panel">
                <div class="panel-title">èˆªç­è¯¦æƒ…</div>
                <div id="flights-content">
                    <div class="loading">è¯·å…ˆé€‰æ‹©ç›®çš„åœ°æœºåœº</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let flights = [];
        let currentDestinations = [];
        let selectedDestination = null;
        let allAirports = [];
        let searchHistory = [];

        // ç®€åŒ–çš„æ‹¼éŸ³æ˜ å°„è¡¨
        const pinyinMap = {
            'åŒ—äº¬': 'beijing', 'ä¸Šæµ·': 'shanghai', 'å¹¿å·': 'guangzhou', 'æ·±åœ³': 'shenzhen',
            'æˆéƒ½': 'chengdu', 'é‡åº†': 'chongqing', 'æ­å·': 'hangzhou', 'è¥¿å®‰': 'xian',
            'å—äº¬': 'nanjing', 'æ­¦æ±‰': 'wuhan', 'å¤©æ´¥': 'tianjin', 'é’å²›': 'qingdao',
            'å¤§è¿': 'dalian', 'å¦é—¨': 'xiamen', 'æ˜†æ˜': 'kunming', 'é•¿æ²™': 'changsha',
            'éƒ‘å·': 'zhengzhou', 'æ²ˆé˜³': 'shenyang', 'å“ˆå°”æ»¨': 'haerbin', 'æµå—': 'jinan',
            'ç¦å·': 'fuzhou', 'çŸ³å®¶åº„': 'shijiazhuang', 'é•¿æ˜¥': 'changchun', 'åˆè‚¥': 'hefei',
            'å—æ˜Œ': 'nanchang', 'è´µé˜³': 'guiyang', 'å¤ªåŸ': 'taiyuan', 'å…°å·': 'lanzhou',
            'æµ·å£': 'haikou', 'ä¸‰äºš': 'sanya', 'ä¹Œé²æœ¨é½': 'wulumuqi', 'æ‹‰è¨': 'lasa',
            'é“¶å·': 'yinchuan', 'è¥¿å®': 'xining', 'å‘¼å’Œæµ©ç‰¹': 'huhehaote', 'å—å®': 'nanning',
            'æ¡‚æ—': 'guilin', 'æ¸©å·': 'wenzhou', 'å®æ³¢': 'ningbo', 'æ— é”¡': 'wuxi',
            'è‹å·': 'suzhou', 'å¸¸å·': 'changzhou', 'å¾å·': 'xuzhou', 'æ‰¬å·': 'yangzhou',
            'æ³°å·': 'taizhou', 'é•‡æ±Ÿ': 'zhenjiang', 'å—é€š': 'nantong', 'ç›åŸ': 'yancheng',
            'æ·®å®‰': 'huaian', 'è¿äº‘æ¸¯': 'lianyungang', 'å®¿è¿': 'suqian', 'é¦–éƒ½': 'shoudu',
            'æµ¦ä¸œ': 'pudong', 'è™¹æ¡¥': 'hongqiao', 'ç™½äº‘': 'baiyun', 'å®å®‰': 'baoan',
            'å¤©åºœ': 'tianfu', 'åŒæµ': 'shuangliu', 'æ±ŸåŒ—': 'jiangbei', 'è§å±±': 'xiaoshan',
            'å’¸é˜³': 'xianyang', 'ç¦„å£': 'lukou', 'èƒ¶ä¸œ': 'jiaodong', 'é«˜å´': 'gaoqi',
            'å‘¨æ°´å­': 'zhoushuizi', 'æ¡ƒä»™': 'taoxian', 'å¤ªå¹³': 'taiping', 'é»„èŠ±': 'huanghua',
            'å¤©æ²³': 'tianhe', 'æ–°éƒ‘': 'xinzheng', 'é¥å¢™': 'yaogiang', 'é•¿ä¹': 'changle',
            'æ˜ŒåŒ—': 'changbei', 'é¾™æ´å ¡': 'longdongbao', 'ä¸­å·': 'zhongchuan', 'å¤©å±±': 'tianshan',
            'è´¡å˜': 'gongga', 'æ²³ä¸œ': 'hedong', 'æ›¹å®¶å ¡': 'caojiabao', 'ç™½å¡”': 'baita',
            'ç¾å…°': 'meilan', 'å‡¤å‡°': 'fenghuang', 'å¤§å…´': 'daxing', 'æœºåœº': 'jichang',
            'å›½é™…': 'guoji', 'å›½å†…': 'guonei', 'èˆªç©º': 'hangkong', 'æ¸¯': 'gang'
        };

        // è·å–æ‹¼éŸ³
        function getPinyin(text) {
            let pinyin = '';
            for (let char of text) {
                if (pinyinMap[char]) {
                    pinyin += pinyinMap[char];
                } else {
                    pinyin += char.toLowerCase();
                }
            }
            return pinyin;
        }

        // åŸå¸‚æ˜ å°„è¡¨
        const cityMapping = {
            'åŒ—äº¬': ['åŒ—äº¬é¦–éƒ½å›½é™…æœºåœº', 'åŒ—äº¬å¤§å…´å›½é™…æœºåœº'],
            'ä¸Šæµ·': ['ä¸Šæµ·è™¹æ¡¥å›½é™…æœºåœº', 'ä¸Šæµ·æµ¦ä¸œå›½é™…æœºåœº'],
            'å¹¿å·': ['å¹¿å·ç™½äº‘å›½é™…æœºåœº'],
            'æ·±åœ³': ['æ·±åœ³å®å®‰å›½é™…æœºåœº'],
            'æˆéƒ½': ['æˆéƒ½å¤©åºœå›½é™…æœºåœº', 'æˆéƒ½åŒæµå›½é™…æœºåœº'],
            'é‡åº†': ['é‡åº†æ±ŸåŒ—å›½é™…æœºåœº'],
            'æ­å·': ['æ­å·è§å±±å›½é™…æœºåœº'],
            'ä¸‰äºš': ['ä¸‰äºšå‡¤å‡°å›½é™…æœºåœº'],
            'æµ·å£': ['æµ·å£ç¾å…°å›½é™…æœºåœº'],
            'æ˜†æ˜': ['æ˜†æ˜é•¿æ°´å›½é™…æœºåœº'],
            'è¥¿å®‰': ['è¥¿å®‰å’¸é˜³å›½é™…æœºåœº'],
            'å—äº¬': ['å—äº¬ç¦„å£å›½é™…æœºåœº'],
            'é’å²›': ['é’å²›èƒ¶ä¸œå›½é™…æœºåœº'],
            'å¦é—¨': ['å¦é—¨é«˜å´å›½é™…æœºåœº'],
            'å¤§è¿': ['å¤§è¿å‘¨æ°´å­å›½é™…æœºåœº'],
            'æ²ˆé˜³': ['æ²ˆé˜³æ¡ƒä»™å›½é™…æœºåœº'],
            'å“ˆå°”æ»¨': ['å“ˆå°”æ»¨å¤ªå¹³å›½é™…æœºåœº'],
            'é•¿æ²™': ['é•¿æ²™é»„èŠ±å›½é™…æœºåœº'],
            'æ­¦æ±‰': ['æ­¦æ±‰å¤©æ²³å›½é™…æœºåœº'],
            'éƒ‘å·': ['éƒ‘å·æ–°éƒ‘å›½é™…æœºåœº'],
            'æµå—': ['æµå—é¥å¢™å›½é™…æœºåœº'],
            'ç¦å·': ['ç¦å·é•¿ä¹å›½é™…æœºåœº'],
            'å—æ˜Œ': ['å—æ˜Œæ˜ŒåŒ—å›½é™…æœºåœº'],
            'è´µé˜³': ['è´µé˜³é¾™æ´å ¡å›½é™…æœºåœº'],
            'å…°å·': ['å…°å·ä¸­å·å›½é™…æœºåœº'],
            'ä¹Œé²æœ¨é½': ['ä¹Œé²æœ¨é½å¤©å±±å›½é™…æœºåœº'],
            'æ‹‰è¨': ['æ‹‰è¨è´¡å˜å›½é™…æœºåœº'],
            'é“¶å·': ['é“¶å·æ²³ä¸œå›½é™…æœºåœº'],
            'è¥¿å®': ['è¥¿å®æ›¹å®¶å ¡æœºåœº'],
            'å‘¼å’Œæµ©ç‰¹': ['å‘¼å’Œæµ©ç‰¹ç™½å¡”å›½é™…æœºåœº']
        };

        // æ ¹æ®æœºåœºåè·å–åŸå¸‚å
        function getCityFromAirport(airport) {
            const isCityMode = document.getElementById('city-mode').checked;

            if (isCityMode) {
                // åŸå¸‚æ¨¡å¼ï¼šä½¿ç”¨å‰ä¸¤ä¸ªå­—ä½œä¸ºåŸå¸‚å
                return airport.substring(0, 2);
            } else {
                // ç²¾ç¡®æ¨¡å¼ï¼šè¿”å›å®Œæ•´æœºåœºå
                return airport;
            }
        }

        // æ ¹æ®åŸå¸‚åè·å–æ‰€æœ‰æœºåœº
        function getAirportsFromCity(city) {
            const isCityMode = document.getElementById('city-mode').checked;

            if (isCityMode) {
                // åŸå¸‚æ¨¡å¼ï¼šæŸ¥æ‰¾æ‰€æœ‰ä»¥è¯¥åŸå¸‚åå¼€å¤´çš„æœºåœº
                return allAirports.filter(airport => airport.startsWith(city));
            } else {
                // ç²¾ç¡®æ¨¡å¼ï¼šè¿”å›å•ä¸ªæœºåœº
                return [city];
            }
        }

        // æ£€æŸ¥ä¸¤ä¸ªæœºåœºæ˜¯å¦å±äºåŒä¸€åŸå¸‚
        function isSameCity(airport1, airport2) {
            const city1 = getCityFromAirport(airport1);
            const city2 = getCityFromAirport(airport2);
            return city1 === city2;
        }
        
        // åŠ è½½èˆªç­æ•°æ®
        async function loadFlights() {
            try {
                const response = await fetch('flights.json');
                flights = await response.json();
                console.log(`åŠ è½½äº† ${flights.length} æ¡èˆªç­æ•°æ®`);
                initializeAirportSelects();
            } catch (error) {
                console.error('åŠ è½½èˆªç­æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½èˆªç­æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿ flights.json æ–‡ä»¶å­˜åœ¨');
            }
        }
        
        // åˆå§‹åŒ–æœºåœºæ•°æ®
        function initializeAirportSelects() {
            const airports = new Set();

            flights.forEach(flight => {
                airports.add(flight.departure);
                airports.add(flight.arrival);
            });

            allAirports = Array.from(airports).sort();

            // åŠ è½½æœç´¢å†å²
            loadSearchHistory();
        }

        // å¤„ç†æœºåœºæœç´¢
        function handleAirportSearch(type) {
            const input = document.getElementById(`airport-${type}-input`);
            const suggestions = document.getElementById(`airport-${type}-suggestions`);
            const query = input.value.toLowerCase();

            if (query.length === 0) {
                // æ²¡æœ‰è¾“å…¥å†…å®¹æ—¶ï¼Œæ˜¾ç¤ºæ‰€æœ‰æœºåœºï¼ˆæŒ‰åŸå¸‚åˆ†ç»„ï¼‰
                showAllAirportsSuggestions(type);
                return;
            }

            // æœ‰è¾“å…¥å†…å®¹æ—¶ï¼Œè¿›è¡Œè¿‡æ»¤æœç´¢
            const matches = allAirports.filter(airport => {
                const airportLower = airport.toLowerCase();
                const airportPinyin = getPinyin(airport);
                return airportLower.includes(query) || airportPinyin.includes(query);
            });

            if (matches.length > 0) {
                let html = '';
                matches.slice(0, 10).forEach(airport => {
                    const highlighted = highlightMatch(airport, query);
                    html += `<div class="suggestion-item" onmousedown="selectAirport('${type}', '${airport}')">${highlighted}</div>`;
                });
                suggestions.innerHTML = html;
                suggestions.style.display = 'block';
            } else {
                suggestions.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºæ‰€æœ‰æœºåœºå»ºè®®ï¼ˆæŒ‰åŸå¸‚åˆ†ç»„ï¼‰
        function showAllAirportsSuggestions(type) {
            const suggestions = document.getElementById(`airport-${type}-suggestions`);

            // æŒ‰åŸå¸‚åˆ†ç»„
            const cityGroups = {};
            allAirports.forEach(airport => {
                const cityName = airport.substring(0, 2); // å‰ä¸¤ä¸ªå­—ä½œä¸ºåŸå¸‚å
                if (!cityGroups[cityName]) {
                    cityGroups[cityName] = [];
                }
                cityGroups[cityName].push(airport);
            });

            // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥åŒ—äº¬çš„åˆ†ç»„
            if (cityGroups['åŒ—äº¬']) {
                console.log('åŒ—äº¬æœºåœºåˆ†ç»„:', cityGroups['åŒ—äº¬']);
            }
            console.log('æ€»å…±æœºåœºæ•°é‡:', allAirports.length);
            console.log('åŸå¸‚åˆ†ç»„æ•°é‡:', Object.keys(cityGroups).length);

            let html = '';
            // æŒ‰åŸå¸‚åæ’åº
            const sortedCities = Object.keys(cityGroups).sort();

            // å…ˆæ˜¾ç¤ºå¤šæœºåœºåŸå¸‚ï¼Œå†æ˜¾ç¤ºå•æœºåœºåŸå¸‚
            const multiAirportCities = [];
            const singleAirportCities = [];

            sortedCities.forEach(cityName => {
                const airports = cityGroups[cityName];
                if (airports.length > 1) {
                    multiAirportCities.push(cityName);
                } else {
                    singleAirportCities.push(cityName);
                }
            });

            // æ˜¾ç¤ºå¤šæœºåœºåŸå¸‚ï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼Œé™åˆ¶å‰10ä¸ªï¼‰
            multiAirportCities.slice(0, 10).forEach(cityName => {
                const airports = cityGroups[cityName];
                html += `<div class="suggestion-item suggestion-city-header">${cityName} (${airports.length}ä¸ªæœºåœº)</div>`;
                airports.forEach(airport => {
                    html += `<div class="suggestion-item suggestion-sub-item" onmousedown="selectAirport('${type}', '${airport}')">&nbsp;&nbsp;${airport}</div>`;
                });
            });

            // æ˜¾ç¤ºå•æœºåœºåŸå¸‚ï¼ˆé™åˆ¶å‰20ä¸ªï¼‰
            singleAirportCities.slice(0, 100).forEach(cityName => {
                const airports = cityGroups[cityName];
                html += `<div class="suggestion-item" onmousedown="selectAirport('${type}', '${airports[0]}')">${airports[0]}</div>`;
            });

            suggestions.innerHTML = html;
            suggestions.style.display = 'block';
        }

        // é«˜äº®åŒ¹é…æ–‡æœ¬
        function highlightMatch(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="suggestion-highlight">$1</span>');
        }

        // é€‰æ‹©æœºåœº
        function selectAirport(type, airport) {
            document.getElementById(`airport-${type}-input`).value = airport;
            document.getElementById(`airport-${type}`).value = airport;
            document.getElementById(`airport-${type}-suggestions`).style.display = 'none';
        }

        // æ˜¾ç¤ºå»ºè®®
        function showSuggestions(type) {
            const input = document.getElementById(`airport-${type}-input`);
            if (input.value.length > 0) {
                handleAirportSearch(type);
            } else {
                // ç‚¹å‡»ç©ºè¾“å…¥æ¡†æ—¶ï¼Œå±•å¼€æ˜¾ç¤ºæ‰€æœ‰æœºåœº
                showAllAirportsSuggestions(type);
            }
        }

        // éšè—å»ºè®®
        function hideSuggestions(type) {
            setTimeout(() => {
                document.getElementById(`airport-${type}-suggestions`).style.display = 'none';
            }, 200);
        }
        
        // ä¿å­˜æœç´¢å†å²
        function saveSearchHistory(airportA, airportB, isCityMode, isSingleMode, resultCount) {
            const historyItem = {
                id: Date.now(),
                airportA: airportA,
                airportB: airportB,
                isCityMode: isCityMode,
                isSingleMode: isSingleMode,
                resultCount: resultCount,
                timestamp: new Date().toLocaleString()
            };

            // é¿å…é‡å¤è®°å½•
            const existing = searchHistory.find(item =>
                item.airportA === airportA &&
                item.airportB === airportB &&
                item.isCityMode === isCityMode &&
                item.isSingleMode === isSingleMode
            );

            if (!existing) {
                searchHistory.unshift(historyItem);
                // æœ€å¤šä¿å­˜10æ¡å†å²è®°å½•
                if (searchHistory.length > 10) {
                    searchHistory = searchHistory.slice(0, 10);
                }
                localStorage.setItem('flightSearchHistory', JSON.stringify(searchHistory));
                displaySearchHistory();
            }
        }

        // åŠ è½½æœç´¢å†å²
        function loadSearchHistory() {
            const saved = localStorage.getItem('flightSearchHistory');
            if (saved) {
                searchHistory = JSON.parse(saved);
                displaySearchHistory();
            }
        }

        // æ˜¾ç¤ºæœç´¢å†å²
        function displaySearchHistory() {
            const content = document.getElementById('history-content');

            if (searchHistory.length === 0) {
                content.innerHTML = '<div class="loading">æš‚æ— æœç´¢å†å²</div>';
                return;
            }

            let html = '';
            searchHistory.forEach(item => {
                const modeText = [];
                if (item.isCityMode) modeText.push('åŸå¸‚æ¨¡å¼');
                if (item.isSingleMode) modeText.push('å•ä¸€å¾€è¿”');
                const modeStr = modeText.length > 0 ? ` (${modeText.join(', ')})` : '';

                html += `
                    <div class="history-item" onclick="loadHistoryItem(${item.id})">
                        <div class="history-item-header">
                            ${item.airportA || 'æœªé€‰æ‹©'} â†” ${item.airportB || 'æœªé€‰æ‹©'}${modeStr}
                        </div>
                        <div class="history-item-details">
                            ${item.timestamp} | æ‰¾åˆ° ${item.resultCount} ä¸ªç›®çš„åœ°
                        </div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        // åŠ è½½å†å²è®°å½•é¡¹
        function loadHistoryItem(id) {
            const item = searchHistory.find(h => h.id === id);
            if (!item) return;

            // è®¾ç½®æœç´¢æ¡ä»¶
            document.getElementById('airport-a-input').value = item.airportA || '';
            document.getElementById('airport-a').value = item.airportA || '';
            document.getElementById('airport-b-input').value = item.airportB || '';
            document.getElementById('airport-b').value = item.airportB || '';
            document.getElementById('city-mode').checked = item.isCityMode;
            document.getElementById('single-mode').checked = item.isSingleMode;

            // è‡ªåŠ¨æ‰§è¡Œæœç´¢
            findDestinations();
        }

        // æ¸…ç©ºæœç´¢å†å²
        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœç´¢å†å²å—ï¼Ÿ')) {
                searchHistory = [];
                localStorage.removeItem('flightSearchHistory');
                displaySearchHistory();
            }
        }

        // æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç›®çš„åœ°
        function findDestinations() {
            const airportA = document.getElementById('airport-a').value;
            const airportB = document.getElementById('airport-b').value;
            const isSingleMode = document.getElementById('single-mode').checked;
            const isCityMode = document.getElementById('city-mode').checked;

            // å•ä¸€å¾€è¿”æ¨¡å¼ï¼šè‡³å°‘éœ€è¦é€‰æ‹©ä¸€ä¸ªæœºåœº
            if (isSingleMode) {
                if (!airportA && !airportB) {
                    alert('è¯·è‡³å°‘é€‰æ‹©Aæœºåœºæˆ–Bæœºåœº');
                    return;
                }
                if (airportA && airportB && airportA === airportB) {
                    alert('Aæœºåœºå’ŒBæœºåœºä¸èƒ½ç›¸åŒ');
                    return;
                }
            } else {
                // åŒé‡å¾€è¿”æ¨¡å¼ï¼šå¿…é¡»é€‰æ‹©ä¸¤ä¸ªæœºåœº
                if (!airportA || !airportB) {
                    alert('è¯·é€‰æ‹©Aæœºåœºå’ŒBæœºåœº');
                    return;
                }
                if (airportA === airportB) {
                    alert('Aæœºåœºå’ŒBæœºåœºä¸èƒ½ç›¸åŒ');
                    return;
                }
            }

            const destinations = findValidDestinations(airportA, airportB);
            displayDestinations(destinations, airportA, airportB);

            // ä¿å­˜æœç´¢å†å²
            saveSearchHistory(airportA, airportB, isCityMode, isSingleMode, destinations.size);

            // æ¸…ç©ºèˆªç­è¯¦æƒ…
            document.getElementById('flights-content').innerHTML =
                '<div class="loading">è¯·é€‰æ‹©ä¸€ä¸ªç›®çš„åœ°æœºåœºæŸ¥çœ‹èˆªç­è¯¦æƒ…</div>';
            selectedDestination = null;
        }
        
        // æŸ¥æ‰¾æœ‰æ•ˆçš„ç›®çš„åœ°æœºåœº
        function findValidDestinations(airportA, airportB) {
            const destinationMap = new Map();
            
            // è·å–æ‰€æœ‰å¯èƒ½çš„ç›®çš„åœ°
            const allDestinations = new Set();
            flights.forEach(flight => {
                if (flight.departure === airportA || flight.departure === airportB) {
                    allDestinations.add(flight.arrival);
                }
            });
            
            // æ£€æŸ¥æ¯ä¸ªç›®çš„åœ°æ˜¯å¦ç¬¦åˆæ¡ä»¶
            allDestinations.forEach(destination => {
                if (destination === airportA || destination === airportB) {
                    return; // è·³è¿‡ä¸å‡ºå‘åœ°ç›¸åŒçš„ç›®çš„åœ°
                }
                
                const result = checkDestination(airportA, airportB, destination);
                if (result.valid) {
                    destinationMap.set(destination, result);
                }
            });
            
            return destinationMap;
        }
        
        // æ£€æŸ¥ç›®çš„åœ°æ˜¯å¦ç¬¦åˆæ¡ä»¶
        function checkDestination(airportA, airportB, destination) {
            const isCityMode = document.getElementById('city-mode').checked;
            const isSingleMode = document.getElementById('single-mode').checked;

            let outboundA = [], outboundB = [], returnA = [], returnB = [];

            // å¤„ç†Aæœºåœºï¼ˆå¦‚æœé€‰æ‹©äº†ï¼‰
            if (airportA) {
                if (isCityMode) {
                    const cityA = getCityFromAirport(airportA);
                    const destCity = getCityFromAirport(destination);
                    const airportsA = getAirportsFromCity(cityA);
                    const destAirports = getAirportsFromCity(destCity);

                    outboundA = flights.filter(flight =>
                        airportsA.includes(flight.departure) &&
                        destAirports.includes(flight.arrival) &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnA = flights.filter(flight =>
                        destAirports.includes(flight.departure) &&
                        airportsA.includes(flight.arrival) &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                } else {
                    outboundA = flights.filter(flight =>
                        flight.departure === airportA &&
                        flight.arrival === destination &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnA = flights.filter(flight =>
                        flight.departure === destination &&
                        flight.arrival === airportA &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                }
            }

            // å¤„ç†Bæœºåœºï¼ˆå¦‚æœé€‰æ‹©äº†ï¼‰
            if (airportB) {
                if (isCityMode) {
                    const cityB = getCityFromAirport(airportB);
                    const destCity = getCityFromAirport(destination);
                    const airportsB = getAirportsFromCity(cityB);
                    const destAirports = getAirportsFromCity(destCity);

                    outboundB = flights.filter(flight =>
                        airportsB.includes(flight.departure) &&
                        destAirports.includes(flight.arrival) &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnB = flights.filter(flight =>
                        destAirports.includes(flight.departure) &&
                        airportsB.includes(flight.arrival) &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                } else {
                    outboundB = flights.filter(flight =>
                        flight.departure === airportB &&
                        flight.arrival === destination &&
                        flight.days.some(day =>
                            (day === 5 && flight.departure_time.hour >= 20) ||
                            (day === 6 && flight.departure_time.hour < 9)
                        )
                    );

                    returnB = flights.filter(flight =>
                        flight.departure === destination &&
                        flight.arrival === airportB &&
                        flight.days.includes(7) &&
                        flight.departure_time.hour >= 20
                    );
                }
            }

            const hasCompleteRouteA = airportA && outboundA.length > 0 && returnA.length > 0;
            const hasCompleteRouteB = airportB && outboundB.length > 0 && returnB.length > 0;

            const routes = [];
            if (hasCompleteRouteA) {
                routes.push({
                    type: isCityMode ? `${getCityFromAirport(airportA)}è·¯çº¿` : 'Aæœºåœºè·¯çº¿',
                    outbound: outboundA,
                    return: returnA
                });
            }

            if (hasCompleteRouteB) {
                routes.push({
                    type: isCityMode ? `${getCityFromAirport(airportB)}è·¯çº¿` : 'Bæœºåœºè·¯çº¿',
                    outbound: outboundB,
                    return: returnB
                });
            }

            // æ ¹æ®æ¨¡å¼å†³å®šæœ‰æ•ˆæ€§
            let isValid;
            if (isSingleMode) {
                // å•ä¸€å¾€è¿”æ¨¡å¼ï¼šåªè¦æœ‰ä¸€ä¸ªæœºåœºæœ‰å®Œæ•´è·¯çº¿å°±ç®—æœ‰æ•ˆ
                isValid = hasCompleteRouteA || hasCompleteRouteB;
            } else {
                // åŒé‡å¾€è¿”æ¨¡å¼ï¼šå¿…é¡»ä¸¤ä¸ªæœºåœºéƒ½æœ‰å®Œæ•´è·¯çº¿æ‰ç®—æœ‰æ•ˆ
                isValid = hasCompleteRouteA && hasCompleteRouteB;
            }

            // ç”Ÿæˆæ‘˜è¦
            let summary;
            if (isSingleMode) {
                if (routes.length === 0) {
                    summary = 'æ— å¯è¡Œè·¯çº¿';
                } else if (routes.length === 1) {
                    summary = `${routes[0].type.replace('è·¯çº¿', '')}å¯å¾€è¿”`;
                } else {
                    summary = isCityMode ? 'ä¸¤åŸå¸‚éƒ½å¯å¾€è¿”' : 'Aã€Bæœºåœºéƒ½å¯å¾€è¿”';
                }
            } else {
                summary = routes.length === 2 ?
                    (isCityMode ? 'ä¸¤åŸå¸‚éƒ½å¯å¾€è¿”' : 'Aã€Bæœºåœºéƒ½å¯å¾€è¿”') :
                    `ä»…${routes.length === 1 ? (hasCompleteRouteA ? (isCityMode ? getCityFromAirport(airportA) : 'A') : (isCityMode ? getCityFromAirport(airportB) : 'B')) : 'æ— '}${isCityMode ? 'åŸå¸‚' : 'æœºåœº'}å¯å¾€è¿”`;
            }

            return {
                valid: isValid,
                routes: routes,
                summary: summary
            };
        }
        
        // æ˜¾ç¤ºç›®çš„åœ°åˆ—è¡¨
        function displayDestinations(destinations, airportA, airportB) {
            const content = document.getElementById('destinations-content');
            const isSingleMode = document.getElementById('single-mode').checked;
            const isCityMode = document.getElementById('city-mode').checked;
            currentDestinations = destinations;

            if (destinations.size === 0) {
                let requirementText;
                if (isSingleMode) {
                    requirementText = 'è¦æ±‚: è‡³å°‘ä¸€ä¸ªæœºåœºæœ‰å®Œæ•´å¾€è¿”èˆªç­';
                    const noResultText = 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç›®çš„åœ°æœºåœº';
                } else {
                    requirementText = 'Aã€Bæœºåœºéƒ½å¿…é¡»æœ‰å®Œæ•´å¾€è¿”èˆªç­';
                    const noResultText = 'æœªæ‰¾åˆ°åŒæ—¶æ»¡è¶³Aã€Bæœºåœºå¾€è¿”æ¡ä»¶çš„ç›®çš„åœ°æœºåœº';
                }

                content.innerHTML = `
                    <div class="criteria-info">
                        <h4>æœç´¢æ¡ä»¶ï¼š</h4>
                        ${airportA ? `<p>â€¢ Aæœºåœº: ${airportA}</p>` : ''}
                        ${airportB ? `<p>â€¢ Bæœºåœº: ${airportB}</p>` : ''}
                        <p>â€¢ å»ç¨‹: å‘¨äº”20:00åæˆ–å‘¨å…­9:00å‰</p>
                        <p>â€¢ è¿”ç¨‹: å‘¨æ—¥20:00å</p>
                        <p><strong>â€¢ ${requirementText}</strong></p>
                        ${isCityMode ? '<p>â€¢ æŒ‰åŸå¸‚åŒ¹é…æ¨¡å¼</p>' : ''}
                        ${isSingleMode ? '<p>â€¢ å•ä¸€å¾€è¿”æ¨¡å¼</p>' : ''}
                    </div>
                    <div class="no-results">
                        ${isSingleMode ? 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç›®çš„åœ°æœºåœº' : 'æœªæ‰¾åˆ°åŒæ—¶æ»¡è¶³Aã€Bæœºåœºå¾€è¿”æ¡ä»¶çš„ç›®çš„åœ°æœºåœº'}
                    </div>
                `;
                return;
            }

            let requirementText;
            if (isSingleMode) {
                requirementText = 'è¦æ±‚: è‡³å°‘ä¸€ä¸ªæœºåœºæœ‰å®Œæ•´å¾€è¿”èˆªç­';
            } else {
                requirementText = 'Aã€Bæœºåœºéƒ½å¿…é¡»æœ‰å®Œæ•´å¾€è¿”èˆªç­';
            }

            let html = `
                <div class="criteria-info">
                    <h4>æœç´¢æ¡ä»¶ï¼š</h4>
                    ${airportA ? `<p>â€¢ Aæœºåœº: ${airportA}</p>` : ''}
                    ${airportB ? `<p>â€¢ Bæœºåœº: ${airportB}</p>` : ''}
                    <p>â€¢ å»ç¨‹: å‘¨äº”20:00åæˆ–å‘¨å…­9:00å‰</p>
                    <p>â€¢ è¿”ç¨‹: å‘¨æ—¥20:00å</p>
                    <p><strong>â€¢ ${requirementText}</strong></p>
                    ${isCityMode ? '<p>â€¢ æŒ‰åŸå¸‚åŒ¹é…æ¨¡å¼</p>' : ''}
                    ${isSingleMode ? '<p>â€¢ å•ä¸€å¾€è¿”æ¨¡å¼</p>' : ''}
                </div>
            `;

            // æŒ‰ç›®çš„åœ°åç§°æ’åº
            const sortedDestinations = Array.from(destinations.entries()).sort((a, b) => a[0].localeCompare(b[0]));

            sortedDestinations.forEach(([destination, info]) => {
                html += `
                    <div class="destination-item" onclick="selectDestination('${destination}')">
                        <div class="destination-name">${destination}</div>
                        <div class="destination-summary">${info.summary}</div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }
        
        // é€‰æ‹©ç›®çš„åœ°
        function selectDestination(destination) {
            selectedDestination = destination;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.destination-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.destination-item').classList.add('selected');
            
            // æ˜¾ç¤ºèˆªç­è¯¦æƒ…
            const destinationInfo = currentDestinations.get(destination);
            displayFlightDetails(destination, destinationInfo);
        }
        
        // æ˜¾ç¤ºèˆªç­è¯¦æƒ…
        function displayFlightDetails(destination, info) {
            const content = document.getElementById('flights-content');
            
            let html = `<div class="criteria-info">
                <h4>ç›®çš„åœ°: ${destination}</h4>
                <p>å…±æ‰¾åˆ° ${info.routes.length} æ¡å¯è¡Œè·¯çº¿</p>
            </div>`;
            
            info.routes.forEach(route => {
                html += `<div class="flight-group">`;
                html += `<div class="group-header">${route.type}</div>`;
                
                // å»ç¨‹èˆªç­
                html += `<div class="flight-detail outbound-flight">`;
                html += `<div class="flight-route">å»ç¨‹èˆªç­</div>`;
                route.outbound.forEach(flight => {
                    const days = flight.days.map(d => ['', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'][d]).join('ã€');
                    html += `
                        <div class="flight-info">
                            <strong>${flight.airline} ${flight.flight_number}</strong><br>
                            ${flight.departure} â†’ ${flight.arrival}<br>
                            <span class="flight-time">èµ·é£: ${flight.departure_time.display} | åˆ°è¾¾: ${flight.arrival_time.display} | æ‰§é£: å‘¨${days}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                
                // è¿”ç¨‹èˆªç­
                html += `<div class="flight-detail return-flight">`;
                html += `<div class="flight-route">è¿”ç¨‹èˆªç­</div>`;
                route.return.forEach(flight => {
                    const days = flight.days.map(d => ['', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'][d]).join('ã€');
                    html += `
                        <div class="flight-info">
                            <strong>${flight.airline} ${flight.flight_number}</strong><br>
                            ${flight.departure} â†’ ${flight.arrival}<br>
                            <span class="flight-time">èµ·é£: ${flight.departure_time.display} | åˆ°è¾¾: ${flight.arrival_time.display} | æ‰§é£: å‘¨${days}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                
                html += `</div>`;
            });
            
            content.innerHTML = html;
        }
        
        // æ›´æ–°æœç´¢æ¨¡å¼
        function updateSearchMode() {
            const isCityMode = document.getElementById('city-mode').checked;
            const isSingleMode = document.getElementById('single-mode').checked;

            // æ›´æ–°åŸå¸‚æ˜ å°„è¡¨ï¼ˆä½¿ç”¨å‰ä¸¤ä¸ªå­—ä½œä¸ºåŸå¸‚åï¼‰
            if (isCityMode) {
                updateCityMappingFromAirports();
            }

            // æ¸…ç©ºå½“å‰æœç´¢ç»“æœ
            document.getElementById('destinations-content').innerHTML =
                '<div class="loading">è¯·é€‰æ‹©æœºåœºå¹¶ç‚¹å‡»æŸ¥æ‰¾</div>';
            document.getElementById('flights-content').innerHTML =
                '<div class="loading">è¯·å…ˆé€‰æ‹©ç›®çš„åœ°æœºåœº</div>';
            currentDestinations = [];
            selectedDestination = null;

            // æ˜¾ç¤ºå½“å‰æ¨¡å¼çŠ¶æ€
            console.log(`æœç´¢æ¨¡å¼æ›´æ–°: åŸå¸‚æ¨¡å¼=${isCityMode}, å•ä¸€å¾€è¿”æ¨¡å¼=${isSingleMode}`);
            if (isCityMode) {
                console.log('åŸå¸‚æ˜ å°„è¡¨å·²æ›´æ–°ï¼Œä½¿ç”¨æœºåœºåå‰ä¸¤ä¸ªå­—ä½œä¸ºåŸå¸‚å');
            }
        }

        // æ ¹æ®æœºåœºåå‰ä¸¤ä¸ªå­—åŠ¨æ€æ›´æ–°åŸå¸‚æ˜ å°„è¡¨
        function updateCityMappingFromAirports() {
            // æ¸…ç©ºç°æœ‰æ˜ å°„
            Object.keys(cityMapping).forEach(key => delete cityMapping[key]);

            // æ ¹æ®æ‰€æœ‰æœºåœºåç”Ÿæˆæ–°çš„åŸå¸‚æ˜ å°„
            const cityGroups = {};

            allAirports.forEach(airport => {
                // æå–åŸå¸‚åï¼ˆå‰ä¸¤ä¸ªå­—ï¼‰
                const cityName = airport.substring(0, 2);

                if (!cityGroups[cityName]) {
                    cityGroups[cityName] = [];
                }
                cityGroups[cityName].push(airport);
            });

            // åªä¿ç•™æœ‰å¤šä¸ªæœºåœºçš„åŸå¸‚ï¼Œæˆ–è€…æ˜ç¡®åŒ…å«"æœºåœº"å­—æ ·çš„
            Object.keys(cityGroups).forEach(cityName => {
                const airports = cityGroups[cityName];
                // å¦‚æœä¸€ä¸ªåŸå¸‚æœ‰å¤šä¸ªæœºåœºï¼Œæˆ–è€…æœºåœºååŒ…å«å¸¸è§çš„æœºåœºæ ‡è¯†è¯
                if (airports.length > 1 || airports.some(airport =>
                    airport.includes('å›½é™…') || airport.includes('æœºåœº') ||
                    airport.includes('èˆªç©º') || airport.includes('æ¸¯'))) {
                    cityMapping[cityName] = airports;
                }
            });

            console.log('åŠ¨æ€ç”Ÿæˆçš„åŸå¸‚æ˜ å°„è¡¨:', cityMapping);
        }



        // é‡ç½®æœç´¢
        function resetSearch() {
            document.getElementById('airport-a-input').value = '';
            document.getElementById('airport-a').value = '';
            document.getElementById('airport-b-input').value = '';
            document.getElementById('airport-b').value = '';
            document.getElementById('city-mode').checked = false;
            document.getElementById('single-mode').checked = false;

            document.getElementById('destinations-content').innerHTML =
                '<div class="loading">è¯·é€‰æ‹©æœºåœºå¹¶ç‚¹å‡»æŸ¥æ‰¾</div>';

            document.getElementById('flights-content').innerHTML =
                '<div class="loading">è¯·å…ˆé€‰æ‹©ç›®çš„åœ°æœºåœº</div>';

            currentDestinations = [];
            selectedDestination = null;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadFlights();
        });
    </script>
</body>
</html>
